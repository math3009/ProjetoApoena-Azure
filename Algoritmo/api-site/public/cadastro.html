<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro</title>

    <script src="./js/funcoes.js"></script>

    <link rel="stylesheet" href="css/cadastro.css" />
    <link rel="icon" href="imgs/logoApoena.png" />

    <script type='text/javascript' src='https://widget.freshworks.com/widgets/72000000689.js' async defer></script>
  </head>
  <body>
    <!-- --------------CABEÇALHOO------------------ -->
    <div class="header">
      <div class="container">
        <h1 class="Titulo">
          <img style="height: 30px" src="imgs/logoApoena.png" alt="" />
          <span class="text_apoena"> Apoena</span>
        </h1>
        <ul class="navbar">
          <li class="agora">
            <a href="index.html">Início</a>
          </li>
          <li class="agora">
            <a href="simulador.html">Orçamento</a>
          </li>
          <li class="agora">|</li>
          <li style="border-bottom: 0.5px solid #04cccc" class="agora">
            <a href="login.html">Login</a>
          </li>
        </ul>
      </div>
    </div>

    <!----------------- Banner------------------ -->
    <div class="banner">
      <div class="container-1">
        <div class="container-2">
          <h1>Criar sua Conta do Apoena</h1>
          <div class="boxes">
            <form id="form_cadastro" method="post" onsubmit="return cadastrar_empresa(), cadastrar_usuario()">
            <div class="box">
              <div class="box-2">


                Nome da empresa: <br>
                <input class="input-empresa" name="nome" placeholder="Apoena" />
                <br> <br>


                <span>CNPJ:</span> <br>
                <input type="text" id="input_cnpj" name="cnpj" maxlength="14" class="input-empresa" placeholder="XXXXXXXXXXXXXX"/> <br>
                <span id="span_cnpj"></span>
                <br>

                <span>Responsavel:</span> <br>
                <input class="input-empresa" name="responsavel" placeholder="Fernando Brandão"/>
                <br><br>
                
                
                <span>Email:</span> <br>
                <input name="email" type="text" id="input_email"  class="input-empresa" placeholder="meuemail@provedor.com"/> <br>
                <span id="span_email" ></span>
                <br>


                <span>Senha:</span> <br>
                <input type="password" name="senha" id="input_senha" class="input-empresa" placeholder="******"/> <br>
                <span id="span_senha" ></span>

            </div>
            
            <div class="box-3">
                
                <span>CPF:</span> <br>
                <input class="input-empresa" name="cpf" maxlength= 11 placeholder="XXXXXXXXXXX"/> <br><br>


                <span>Cargo:</span> <br>
                <input class="input-empresa" name="cargo" placeholder="Gerente Geral"/> <br><br>


                <span>Setor:</span> <br>
                <input class="input-empresa" name="setor" placeholder="Governança"/> <br><br>

                <span>Confimar:</span> <br>
                <input type="password" name="confirmacao-senha" id="input_confimar" class="input-empresa" placeholder="******"/> <br>
                <span id="span_confirmar"></span>
                  <br>
                
                <button class="button_conta">Cadastrar</button>
                  
              </div>
            </div>


            
            </div>
            
          </form>
        </div>
        <div id="div_aguardar" class="loading-div">
          <img src="../Algoritmo/imgs/assets/circle-loading.gif" id="loading-gif">
      </div>

      <div id="div_erros_login">

      </div>
      </div>
    </div>
  </body>
</html>
<script>
function limparFormulario() {
        document.getElementById("form_cadastro").reset();
    }

    function cadastrar_empresa() {
        aguardar();

        var formulario = new URLSearchParams(new FormData(document.getElementById("form_cadastro")));

        var nome = formulario.get("nome");
        var cnpj = formulario.get("cnpj");
        var responsavel = formulario.get("responsavel");
        var cpf = formulario.get("cpf");
        var cargo = formulario.get("cargo");
        var setor = formulario.get("setor");
        var email = formulario.get("email");
        var senha = formulario.get("senha");
        var confirmacaoSenha = formulario.get("confirmacao-senha");

        if (nome == "" || cnpj == "" || responsavel == "" || email == "" || senha == "" || confirmacaoSenha == "") {

            window.alert("Preencha todos os campos para prosseguir!");
            if (nome == "") {
                console.log('nome está em branco')
            }
            if (cnpj == "") {
                console.log('cnpj está em branco')
            }
            if (responsavel == "") {
                console.log('responsavel está em branco')
            }
            if (email == "") {
                console.log('email está em branco')
            }
            if (senha == "") {
                console.log('senha está em branco')
            }
            if (confirmacaoSenha == "") {
                console.log('confirmacaoSenha está em branco')
            }
            finalizarAguardar();
            return false;
        }

        if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
            window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
            finalizarAguardar();
            return false;
        }

        if (cnpj.length != 14){
          window.alert("Ops, cnpj inválido! Verifique e tente novamente.");
            finalizarAguardar();
            return false;
        }

        if (senha != confirmacaoSenha) {
            window.alert("As senhas inseridas devem ser iguais para prosseguir!");
            finalizarAguardar();
            return false;
        }

        fetch("/usuarios/cadastrar_empresa", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Cadastro realizado com sucesso!");
                window.location = "login.html";
                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }

    function cadastrar_usuario() {
        aguardar();

        var formulario = new URLSearchParams(new FormData(document.getElementById("form_cadastro")));

        var nome = formulario.get("nome");
        var cnpj = formulario.get("cnpj");
        var responsavel = formulario.get("responsavel");
        var cpf = formulario.get("cpf");
        var cargo = formulario.get("cargo");
        var setor = formulario.get("setor");
        var email = formulario.get("email");
        var senha = formulario.get("senha");
        var confirmacaoSenha = formulario.get("confirmacao-senha");

        if (nome == "" || cnpj == "" || responsavel == "" || email == "" || senha == "" || confirmacaoSenha == "") {

            window.alert("Preencha todos os campos para prosseguir!");
            if (nome == "") {
                console.log('nome está em branco')
            }
            if (cnpj == "") {
                console.log('cnpj está em branco')
            }
            if (responsavel == "") {
                console.log('responsavel está em branco')
            }
            if (email == "") {
                console.log('email está em branco')
            }
            if (senha == "") {
                console.log('senha está em branco')
            }
            if (confirmacaoSenha == "") {
                console.log('confirmacaoSenha está em branco')
            }
            finalizarAguardar();
            return false;
        }

        if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
            window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
            finalizarAguardar();
            return false;
        }

        if (cnpj.length != 14){
          window.alert("Ops, cnpj inválido! Verifique e tente novamente.");
            finalizarAguardar();
            return false;
        }

        if (senha != confirmacaoSenha) {
            window.alert("As senhas inseridas devem ser iguais para prosseguir!");
            finalizarAguardar();
            return false;
        }

        fetch("/usuarios/cadastrar_usuario", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                window.alert("Cadastro realizado com sucesso!");
                window.location = "login.html";
                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            finalizarAguardar();
        });

        return false;
    }
</script>

<script>
  // HELP DESK ----------------------------------- //

      window.fwSettings={
      'widget_id':72000000689
      };
      !function(){if("function"!=typeof window.FreshworksWidget){var n=function(){n.q.push(arguments)};n.q=[],window.FreshworksWidget=n}}()  

  //-----------------------------------------------//
  </script>